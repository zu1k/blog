<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="/xsl/rss.xsl"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>Docker - æ ‡ç­¾ - zu1k</title><link>https://zu1k.com/tags/docker/</link><description/><language>zh-CN</language><managingEditor>i@zu1k.com (zu1k)</managingEditor><webMaster>i@zu1k.com (zu1k)</webMaster><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Sun, 08 Mar 2020 21:16:07 +0800</lastBuildDate><atom:link href="https://zu1k.com/tags/docker/" rel="self" type="application/rss+xml"/><item><title>åŠ é€Ÿdocker pull</title><link>https://zu1k.com/posts/coding/speedup-docker-pull/</link><pubDate>Sun, 08 Mar 2020 21:16:07 +0800</pubDate><author>zu1k</author><guid>https://zu1k.com/posts/coding/speedup-docker-pull/</guid><description><![CDATA[<h2 id="ä¸ºdockerè®¾ç½®ä»£ç†"><a href="#ä¸ºdockerè®¾ç½®ä»£ç†" class="header-mark headerLink">ä¸ºdockerè®¾ç½®ä»£ç†</a></h2>
<p>ç¯å¢ƒæ˜¯åœ¨centosä¸‹ï¼Œå¦‚æœæ²¡æœ‰æ–°å»ºä¸‹é¢è¿™ä¸ªæ–‡ä»¶å¤¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/systemd/system/docker.service.d
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹‹åæ–°å»ºä¸‹é¢è¿™ä¸ªæ–‡ä»¶èµ°httpä»£ç†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo vim /etc/systemd/system/docker.service.d/http-proxy.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¡«å…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>Service<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">Environment</span><span class="o">=</span><span class="s2">&#34;HTTP_PROXY=http://192.168.88.10:7890/&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–è¾‘ä¸‹é¢è¿™ä¸ªæ–‡ä»¶èµ°httpsä»£ç†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vim /etc/systemd/system/docker.service.d/https-proxy.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¿®æ”¹ä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>Service<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">Environment</span><span class="o">=</span><span class="s2">&#34;HTTPS_PROXY=https://proxy.example.com:443/&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹‹åä½ ä½¿ç”¨docker pullçš„æ—¶å€™å°±å¯ä»¥pull gcr.ioä¸Šçš„é•œåƒäº†</p>
<p><a href="https://juejin.im/post/5cc7b53c51882525124126f1" target="_blank" rel="noopener noreffer" class="post-link">https://juejin.im/post/5cc7b53c51882525124126f1</a><br>
<a href="https://docs.docker.com/config/daemon/systemd" target="_blank" rel="noopener noreffer" class="post-link">https://docs.docker.com/config/daemon/systemd</a></p>
<h2 id="æ¢å›½å†…æº"><a href="#æ¢å›½å†…æº" class="header-mark headerLink">æ¢å›½å†…æº</a></h2>
<p>åˆ›å»ºæˆ–ä¿®æ”¹ <code>/etc/docker/daemon.json</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/docker
</span></span><span class="line"><span class="cl">sudo tee /etc/docker/daemon.json <span class="s">&lt;&lt;-&#39;EOF&#39;
</span></span></span><span class="line"><span class="cl"><span class="s">{
</span></span></span><span class="line"><span class="cl"><span class="s">    &#34;registry-mirrors&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="s">        &#34;https://u8rbddql.mirror.aliyuncs.com&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">        &#34;https://docker.mirrors.ustc.edu.cn&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">        &#34;https://mirror.ccs.tencentyun.com&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">        &#34;https://registry.docker-cn.com&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">    ]
</span></span></span><span class="line"><span class="cl"><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">sudo systemctl daemon-reload
</span></span><span class="line"><span class="cl">sudo systemctl restart docker
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://juejin.im/post/5cd2cf01f265da0374189441" target="_blank" rel="noopener noreffer" class="post-link">https://juejin.im/post/5cd2cf01f265da0374189441</a></p>
]]></description></item><item><title>ç»™dockeré‡Œçš„æ¯ä¸€ä¸ªå®¹å™¨ä¸€ä¸ªç‹¬ç«‹çš„ipv6åœ°å€</title><link>https://zu1k.com/posts/coding/set-ipv6-for-every-docker-container/</link><pubDate>Sat, 31 Aug 2019 14:39:03 +0800</pubDate><author>zu1k</author><guid>https://zu1k.com/posts/coding/set-ipv6-for-every-docker-container/</guid><description><![CDATA[<p>ipv6ä¸æ–­æ™®åŠï¼Œipv6åœ°å€å¤šçš„æ•°ä¸èƒœæ•°ï¼Œæœºæˆ¿ç»™å•å°æœºå™¨åˆ†é…çš„ipv6æ®µè¾¾åˆ°äº†å¯æ€•çš„64ä½é•¿åº¦çš„å­ç½‘ä¸»æœºå·ã€‚</p>
<p>é‚£æˆ‘ä¸ç¦åœ¨æƒ³ï¼Œèƒ½ä¸èƒ½ç»™dockerä¸‹çš„æ¯ä¸ªå®¹å™¨ç‹¬ç«‹çš„ipv6åœ°å€ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ˜ å°„ç«¯å£å·äº†ã€‚</p>
<p>æ‰€ä»¥å°±æœ‰äº†ä»¥ä¸‹å®è·µï¼š</p>
<p>é¦–å…ˆï¼Œç»™docker engineå¼€å¯ipv6æ”¯æŒ, å‚è€ƒï¼š <a href="https://docs.docker.com/config/daemon/ipv6/" target="_blank" rel="noopener noreffer" class="post-link">https://docs.docker.com/config/daemon/ipv6/</a></p>
<p>é…ç½®/etc/docker/daemon.jsonæ–‡ä»¶å¦‚ä¸‹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;ipv6&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;fixed-cidr-v6&#34;</span><span class="p">:</span> <span class="s2">&#34;2001ğŸ”¢5001ğŸ”¢:/64&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œ <code>systemctl reload docker</code> é‡è½½Docker Engineçš„é…ç½®æ–‡ä»¶</p>
<p>è¿™æ ·dockeré»˜è®¤çš„bridgeç½‘ç»œå°±ä¼šç»™å®¹å™¨åˆ†é…éšæœºçš„ipv6åœ°å€äº†ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬é€šå¸¸éœ€è¦å›ºå®šçš„ipv6åœ°å€ï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ è‡ªå®šä¹‰ç½‘æ¡¥ç½‘ç»œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker network create <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -d bridge --ipv6 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --subnet <span class="s2">&#34;2001ğŸ”¢5001ğŸ”¢6666::/80&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --gateway<span class="o">=</span><span class="s2">&#34;2001ğŸ”¢5001ğŸ”¢6666::1&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --subnet<span class="o">=</span>172.28.0.0/16 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --gateway<span class="o">=</span>172.28.0.1 ipv6
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åå¯åŠ¨dockerå®¹å™¨æ—¶å€™æŒ‡å®šipv6ç½‘æ¡¥å’Œipv6åœ°å€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -itd -P --ip<span class="o">=</span>172.28.0.101 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --ip6<span class="o">=</span><span class="s2">&#34;2001ğŸ”¢5001ğŸ”¢6666::101&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --network<span class="o">=</span>ipv6 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --name<span class="o">=</span>ipv6test <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    ubuntu:18.04 /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤æ—¶å®¹å™¨å·²ç»æœ‰ç‹¬ç«‹çš„ipv6åœ°å€äº†ï¼Œæˆ‘ä»¬å‘ç°å‘å¤–è®¿é—®å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯å¤–ç•Œè®¿é—®ä¸åˆ°dockeråé¢éšè—çš„container
è¿™æ˜¯å› ä¸ºipv6ä½¿ç”¨NDPåè®®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å®¹å™¨çš„å®¿ä¸»æœºä¸Šè®¾ç½® ndpä»£ç†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sysctl net.ipv6.conf.ens3.proxy_ndp<span class="o">=</span><span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ens3æ˜¯æˆ‘çš„å®¿ä¸»æœºå¤–ç½‘ç½‘å¡ï¼Œè¿™é‡Œéœ€è¦æ›¿æ¢æˆä½ è‡ªå·±çš„</p>
</blockquote>
<p>è¿™é‡Œæ¯ä¸€ä¸ªdockeråˆ†é…çš„ipv6åœ°å€éƒ½éœ€è¦æ·»åŠ è¿™æ ·ä¸€æ¡è§„åˆ™</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ip -6 neigh add proxy 2001ğŸ”¢5001ğŸ”¢6666::101 dev ens3
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item></channel></rss>