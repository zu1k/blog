<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=X-UA-Compatible content="IE=edge, chrome=1"><title>静态链接OpenSSL进行RSA\MD5\Base64 - zu1k</title><meta name=description content="A boy dreaming of traveling around the world.<br>This blog is used to record my study, thinking and life.">
<meta name=keywords content="zu1k,zuik,zu1k.com,网络安全,思考,逆向"><meta name=author content="zu1k"><meta property="og:title" content="静态链接OpenSSL进行RSA\MD5\Base64"><meta property="og:description" content="简介 目标平台： Windows 10 amd64 使用静态链接方式，原因：动态链接库太大了，包含很多本次实验不需要的函数 准备工作 下载OpenSSL代码 git clone https://github.com/OpenSSL/OpenSSL.git 或者从官网 https://www.OpenSSL.org/source/ 下"><meta property="og:type" content="article"><meta property="og:url" content="https://zu1k.com/posts/coding/openssl-first-try-rsa-md5-base64/"><meta property="og:image" content="https://zu1k.com/images/logo.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-18T12:50:10+08:00"><meta property="article:modified_time" content="2023-10-10T10:23:16+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://zu1k.com/images/logo.jpg"><meta name=twitter:title content="静态链接OpenSSL进行RSA\MD5\Base64"><meta name=twitter:description content="简介 目标平台： Windows 10 amd64 使用静态链接方式，原因：动态链接库太大了，包含很多本次实验不需要的函数 准备工作 下载OpenSSL代码 git clone https://github.com/OpenSSL/OpenSSL.git 或者从官网 https://www.OpenSSL.org/source/ 下"><meta name=twitter:site content="@zu1k_"><meta name=application-name content="zu1k"><meta name=apple-mobile-web-app-title content="zu1k"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><meta itemprop=name content="静态链接OpenSSL进行RSA\MD5\Base64"><meta itemprop=description content="简介 目标平台： Windows 10 amd64 使用静态链接方式，原因：动态链接库太大了，包含很多本次实验不需要的函数 准备工作 下载OpenSSL代码 git clone https://github.com/OpenSSL/OpenSSL.git 或者从官网 https://www.OpenSSL.org/source/ 下"><meta itemprop=datePublished content="2020-03-18T12:50:10+08:00"><meta itemprop=dateModified content="2023-10-10T10:23:16+08:00"><meta itemprop=wordCount content="1097"><meta itemprop=image content="https://zu1k.com/images/logo.jpg"><meta itemprop=keywords content="OpenSSL,coding,"><link rel="shortcut icon" type=image/x-icon href=../../../favicon.ico><link rel=icon type=image/png sizes=32x32 href=../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=../../../apple-touch-icon.png><link rel=mask-icon href=../../../apple-touch-icon.png color=#5bbad5><link rel=manifest href=../../../site.webmanifest><link rel=canonical href=https://zu1k.com/posts/coding/openssl-first-try-rsa-md5-base64/><link rel=prev href=https://zu1k.com/posts/coding/speedup-docker-pull/><link rel=next href=https://zu1k.com/posts/linux/ubuntu-iptables-nat/><link rel=stylesheet href=../../../lib/normalize/normalize.min.css><link rel=stylesheet href=../../../css/style.min.css><link rel=stylesheet href=../../../lib/icon/css/icon-embedded.css><script>"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js")})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-J44P41XVM9"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J44P41XVM9",{anonymize_ip:!1})}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"静态链接OpenSSL进行RSA\\MD5\\Base64","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/zu1k.com\/posts\/coding\/openssl-first-try-rsa-md5-base64\/"},"image":[{"@type":"ImageObject","url":"https:\/\/zu1k.com\/images\/logo.jpg","width":256,"height":256}],"genre":"posts","keywords":"OpenSSL, coding","wordcount":1097,"url":"https:\/\/zu1k.com\/posts\/coding\/openssl-first-try-rsa-md5-base64\/","datePublished":"2020-03-18T12:50:10+08:00","dateModified":"2023-10-10T10:23:16+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"zu1k","logo":"https:\/\/zu1k.com\/images\/logo.jpg"},"author":{"@type":"Person","name":"zu1k"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=../../../ title=zu1k>zu1k</a></div><div class=menu><div class=menu-inner><a class=menu-item href=../../../posts/>文章 </a><a class=menu-item href=../../../categories/>分类 </a><a class=menu-item href=../../../tags/>标签 </a><a class=menu-item href=../../../projects/>项目 </a><a class=menu-item href=../../../links/>友链 </a><a class=menu-item href=../../../about/>关于 </a><a class=menu-item href=../../../rss.xml title=RSS><i class=icon-rss></i> </a><a class=menu-item href=https://github.com/zu1k title=GitHub rel="noopener noreffer" target=_blank><i class=icon-github></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class=icon-search></i>
</a><a class="search-button search-clear" id=search-clear-desktop title=清空><i class=icon-cancel-circled></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class=icon-spin2></i>
</span></span><a class="menu-item theme-switch" title=切换主题><i class=icon-adjust></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=../../../ title=zu1k>zu1k</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class=icon-search></i>
</a><a class="search-button search-clear" id=search-clear-mobile title=清空><i class=icon-cancel-circled></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class=icon-spin2></i></span></div><a class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=../../../posts/ title>文章</a><a class=menu-item href=../../../categories/ title>分类</a><a class=menu-item href=../../../tags/ title>标签</a><a class=menu-item href=../../../projects/ title>项目</a><a class=menu-item href=../../../links/ title>友链</a><a class=menu-item href=../../../about/ title>关于</a><a class=menu-item href=../../../rss.xml title=RSS><i class=icon-rss></i></a><a class=menu-item href=https://github.com/zu1k title=GitHub rel="noopener noreffer" target=_blank><i class=icon-github></i></a><a class="menu-item theme-switch" title=切换主题>
<i class=icon-adjust></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class=single-title>静态链接OpenSSL进行RSA\MD5\Base64</h1><div class=post-meta><div class=post-meta-line>&nbsp;<span class=post-category>收录于 <a href=../../../categories/coding/><i class=icon-folder></i>编程</a></span></div><div class=post-meta-line><i class=icon-calendar></i>&nbsp;<time datetime=2020-03-18>2020-03-18</time>&nbsp;<i class=icon-pencil></i>&nbsp;约 1097 字&nbsp;
<i class=icon-clock></i>&nbsp;阅读 3 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon icon-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#简介>简介</a></li><li><a href=#准备工作>准备工作</a><ul><li><a href=#下载openssl代码>下载OpenSSL代码</a></li><li><a href=#安装perl环境这里使用的是activeperl>安装perl环境，这里使用的是ActivePerl</a></li><li><a href=#安装nasm汇编器>安装NASM汇编器</a></li><li><a href=#配置环境变量>配置环境变量</a></li></ul></li><li><a href=#编译-openssl-静态链接库>编译 OpenSSL 静态链接库</a><ul><li><a href=#初始化环境>初始化环境</a></li><li><a href=#生成编译配置文件>生成编译配置文件</a></li><li><a href=#进行编译并测试和安装>进行编译并测试和安装</a></li></ul></li><li><a href=#使用openssl的api进行编程>使用OpenSSL的api进行编程</a><ul><li><a href=#visual-studio项目配置>visual studio项目配置</a></li><li><a href=#添加头文件>添加头文件</a></li><li><a href=#使用md5对字符串生成摘要>使用MD5对字符串生成摘要</a></li><li><a href=#生成rsa密钥对并以pem格式写入文件>生成rsa密钥对并以pem格式写入文件</a></li><li><a href=#对数据进行base64编码base64在bio中有>对数据进行Base64编码，Base64在BIO中有</a></li><li><a href=#最后通过main函数读入字符串并将三个过程连起来>最后通过main函数读入字符串并将三个过程连起来</a></li></ul></li><li><a href=#运行>运行</a><ul><li><a href=#运行截图>运行截图</a></li><li><a href=#生成的私钥文件>生成的私钥文件</a></li><li><a href=#生成的公钥文件>生成的公钥文件</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=简介><a href=#简介 class="header-mark headerLink">简介</a></h2><p>目标平台： Windows 10 amd64</p><p>使用静态链接方式，原因：动态链接库太大了，包含很多本次实验不需要的函数</p><h2 id=准备工作><a href=#准备工作 class="header-mark headerLink">准备工作</a></h2><h3 id=下载openssl代码><a href=#下载openssl代码 class="header-mark headerLink">下载OpenSSL代码</a></h3><p><code>git clone https://github.com/OpenSSL/OpenSSL.git</code></p><p>或者从官网 <a href=https://www.OpenSSL.org/source/ target=_blank rel="noopener noreffer" class=post-link>https://www.OpenSSL.org/source/</a> 下载源代码</p><p>我使用的是OpenSSL 1.1.1</p><h3 id=安装perl环境这里使用的是activeperl><a href=#安装perl环境这里使用的是activeperl class="header-mark headerLink">安装perl环境，这里使用的是ActivePerl</a></h3><p><a href=https://www.activestate.com/products/perl/ target=_blank rel="noopener noreffer" class=post-link>https://www.activestate.com/products/perl/</a></p><h3 id=安装nasm汇编器><a href=#安装nasm汇编器 class="header-mark headerLink">安装NASM汇编器</a></h3><p><a href=https://www.nasm.us/ target=_blank rel="noopener noreffer" class=post-link>https://www.nasm.us/</a></p><h3 id=配置环境变量><a href=#配置环境变量 class="header-mark headerLink">配置环境变量</a></h3><p>将刚刚安装的nasm和perl的bin目录加入PATH</p><p><img src=../../../posts/coding/openssl-first-try-rsa-md5-base64/env_hu1b339cdcef088ba71c0e08c5bd4346ed_9406_526x161_resize_q75_h2_box_3.webp alt=/posts/coding/openssl-first-try-rsa-md5-base64/env_hu1b339cdcef088ba71c0e08c5bd4346ed_9406_526x161_resize_q75_h2_box_3.webp title=环境变量PATH height=161 width=526 loading=lazy></p><h2 id=编译-openssl-静态链接库><a href=#编译-openssl-静态链接库 class="header-mark headerLink">编译 OpenSSL 静态链接库</a></h2><h3 id=初始化环境><a href=#初始化环境 class="header-mark headerLink">初始化环境</a></h3><p>使用visual studio自带的命令提示工具初始化环境，因为需要使用nmake</p><p><img src=../../../posts/coding/openssl-first-try-rsa-md5-base64/vs1_hu69c0279074ebca3855950d2a6e40bda3_363283_306x296_resize_q75_h2_box_3.webp alt=/posts/coding/openssl-first-try-rsa-md5-base64/vs1_hu69c0279074ebca3855950d2a6e40bda3_363283_306x296_resize_q75_h2_box_3.webp title=tool height=296 width=306 loading=lazy></p><p><img src=../../../posts/coding/openssl-first-try-rsa-md5-base64/vs2_huec5bcc4756c6ba8aa94a769c68107934_8156_560x171_resize_q75_h2_box_3.webp alt=/posts/coding/openssl-first-try-rsa-md5-base64/vs2_huec5bcc4756c6ba8aa94a769c68107934_8156_560x171_resize_q75_h2_box_3.webp title=tool height=171 width=560 loading=lazy></p><h3 id=生成编译配置文件><a href=#生成编译配置文件 class="header-mark headerLink">生成编译配置文件</a></h3><p>cd进入OpenSSL源码目录</p><p>执行 <code>perl Configure VC-WIN64A no-asm no-shared --prefix="D:\Project\OpenSSLwork\OpenSSL\build" --OpenSSLdir="D:\Project\OpenSSLwork\OpenSSL\build\ssl"</code></p><h3 id=进行编译并测试和安装><a href=#进行编译并测试和安装 class="header-mark headerLink">进行编译并测试和安装</a></h3><div class=highlight><div class=chroma><div class=table-wrapper><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>nmake
</span></span><span class=line><span class=cl>nmake <span class=nb>test</span>
</span></span><span class=line><span class=cl>nmake install
</span></span></code></pre></td></tr></table></div></div></div><p>此时已经有了我们需要的头文件和静态链接lib库</p><p><img src=../../../posts/coding/openssl-first-try-rsa-md5-base64/build1_hu019cf07ffb320f505a901e8f9e7586b0_14981_651x189_resize_q75_h2_box_3.webp alt=/posts/coding/openssl-first-try-rsa-md5-base64/build1_hu019cf07ffb320f505a901e8f9e7586b0_14981_651x189_resize_q75_h2_box_3.webp title=dir height=189 width=651 loading=lazy></p><p><img src=../../../posts/coding/openssl-first-try-rsa-md5-base64/build2_hudeaca1bd4f1a08f445bfebd53c3ef518_57314_155x92_resize_q75_h2_box_3.webp alt=/posts/coding/openssl-first-try-rsa-md5-base64/build2_hudeaca1bd4f1a08f445bfebd53c3ef518_57314_155x92_resize_q75_h2_box_3.webp title=lib height=92 width=155 loading=lazy></p><h2 id=使用openssl的api进行编程><a href=#使用openssl的api进行编程 class="header-mark headerLink">使用OpenSSL的api进行编程</a></h2><h3 id=visual-studio项目配置><a href=#visual-studio项目配置 class="header-mark headerLink">visual studio项目配置</a></h3><p>vs创建空项目，然后配置头文件和库文件的路径</p><p>项目右键-属性，配置选择所有配置，平台选择x64</p><p><code>VC++ 目录</code> 配置里面的 <code>包含目录</code> 添加OpenSSL的头文件目录, 我这里是 <code>D:\Project\OpenSSLwork\OpenSSL\build\include;</code></p><p><img src=../../../posts/coding/openssl-first-try-rsa-md5-base64/vsw1_hu175bf96b41aac86de79120bd8ed4b83a_26183_783x241_resize_q75_h2_box_3.webp alt=/posts/coding/openssl-first-try-rsa-md5-base64/vsw1_hu175bf96b41aac86de79120bd8ed4b83a_26183_783x241_resize_q75_h2_box_3.webp title=lib height=241 width=783 loading=lazy></p><p><code>链接器</code> 里面的 <code>输入</code> 的 <code>附加依赖项</code> 添加 静态库名，<code>libcrypto.lib;libssl.lib;</code></p><blockquote><p>注意：在使用OpenSSL的静态链接库时，除了添加 <code>libcrypto.lib;libssl.lib;</code>，还需要添加系统的依赖库：<code>crypt32.lib;WS2_32.lib;</code>， 因为OpenSSL在windows平台使用了这些库。
完整的： <code>kernel32.lib;user32.lib;gdi32.lib;winspool.lib;comdlg32.lib;advapi32.lib;shell32.lib;ole32.lib;oleaut32.lib;uuid.lib;odbc32.lib;odbccp32.lib;%(AdditionalDependencies);crypt32.lib;libcrypto.lib;libssl.lib;WS2_32.lib;</code></p></blockquote><h3 id=添加头文件><a href=#添加头文件 class="header-mark headerLink">添加头文件</a></h3><p>因为需要md5,rsa,Base64等操作，这里需要导入OpenSSL四个相关的头文件</p><div class=highlight><div class=chroma><div class=table-wrapper><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;OpenSSL/rsa.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;OpenSSL/pem.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;OpenSSL/md5.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;OpenSSL/bio.h&gt;</span><span class=cp>
</span></span></span></code></pre></td></tr></table></div></div></div><h3 id=使用md5对字符串生成摘要><a href=#使用md5对字符串生成摘要 class="header-mark headerLink">使用MD5对字符串生成摘要</a></h3><div class=highlight><div class=chroma><div class=table-wrapper><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=kt>int</span> <span class=nf>md5_hash</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>in</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kt>char</span> <span class=o>*</span><span class=n>md</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>char</span><span class=o>*</span> <span class=n>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>unsigned</span> <span class=kt>char</span><span class=o>*</span> <span class=n>str</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>char</span><span class=o>*</span><span class=p>)</span><span class=n>in</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>MD5</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>strlen</span><span class=p>(</span><span class=n>in</span><span class=p>),</span> <span class=n>md</span><span class=p>);</span> <span class=c1>//调用OpenSSL的md5方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><h3 id=生成rsa密钥对并以pem格式写入文件><a href=#生成rsa密钥对并以pem格式写入文件 class="header-mark headerLink">生成rsa密钥对并以pem格式写入文件</a></h3><div class=highlight><div class=chroma><div class=table-wrapper><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>RSA</span> <span class=o>*</span> <span class=nf>gen_rsa</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>bits</span> <span class=o>=</span> <span class=mi>1024</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>RSA</span><span class=o>*</span> <span class=n>rsa</span> <span class=o>=</span> <span class=n>RSA_new</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>BIGNUM</span><span class=o>*</span> <span class=n>e</span> <span class=o>=</span> <span class=n>BN_new</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>BN_set_word</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>RSA_F4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>rc</span> <span class=o>=</span> <span class=n>RSA_generate_key_ex</span><span class=p>(</span><span class=n>rsa</span><span class=p>,</span> <span class=n>bits</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span> <span class=c1>//OpenSSL中生成rsa key的新方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>BN_free</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>rc</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>)</span> <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>   
</span></span><span class=line><span class=cl>    <span class=n>size_t</span> <span class=n>pri_len</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>size_t</span> <span class=n>pub_len</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span><span class=o>*</span> <span class=n>pri_key</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span><span class=o>*</span> <span class=n>pub_key</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>BIO</span><span class=o>*</span> <span class=n>pubkey</span> <span class=o>=</span> <span class=n>BIO_new_file</span><span class=p>(</span><span class=s>&#34;public.pem&#34;</span><span class=p>,</span> <span class=s>&#34;w&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>BIO</span><span class=o>*</span> <span class=n>prikey</span> <span class=o>=</span> <span class=n>BIO_new_file</span><span class=p>(</span><span class=s>&#34;private.pem&#34;</span><span class=p>,</span> <span class=s>&#34;w&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>PEM_write_bio_RSAPrivateKey</span><span class=p>(</span><span class=n>prikey</span><span class=p>,</span> <span class=n>rsa</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span> <span class=c1>//私钥写入文件
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>PEM_write_bio_RSAPublicKey</span><span class=p>(</span><span class=n>pubkey</span><span class=p>,</span> <span class=n>rsa</span><span class=p>);</span> <span class=c1>//公钥写入文件
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=n>rsa</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><h3 id=对数据进行base64编码base64在bio中有><a href=#对数据进行base64编码base64在bio中有 class="header-mark headerLink">对数据进行Base64编码，Base64在BIO中有</a></h3><div class=highlight><div class=chroma><div class=table-wrapper><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Base64_encode</span><span class=p>(</span><span class=k>const</span> <span class=kt>unsigned</span> <span class=kt>char</span><span class=o>*</span> <span class=n>buffer</span><span class=p>,</span> <span class=n>size_t</span> <span class=n>length</span><span class=p>,</span> <span class=kt>char</span><span class=o>**</span> <span class=n>b64text</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>BIO</span><span class=o>*</span> <span class=n>bio</span><span class=p>,</span> <span class=o>*</span> <span class=n>b64</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>BUF_MEM</span><span class=o>*</span> <span class=n>bufferPtr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>b64</span> <span class=o>=</span> <span class=n>BIO_new</span><span class=p>(</span><span class=n>BIO_f_Base64</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=n>bio</span> <span class=o>=</span> <span class=n>BIO_new</span><span class=p>(</span><span class=n>BIO_s_mem</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=n>bio</span> <span class=o>=</span> <span class=n>BIO_push</span><span class=p>(</span><span class=n>b64</span><span class=p>,</span> <span class=n>bio</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>BIO_set_flags</span><span class=p>(</span><span class=n>bio</span><span class=p>,</span> <span class=n>BIO_FLAGS_Base64_NO_NL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>BIO_write</span><span class=p>(</span><span class=n>bio</span><span class=p>,</span> <span class=n>buffer</span><span class=p>,</span> <span class=n>length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>BIO_flush</span><span class=p>(</span><span class=n>bio</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>BIO_get_mem_ptr</span><span class=p>(</span><span class=n>bio</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>bufferPtr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>BIO_set_close</span><span class=p>(</span><span class=n>bio</span><span class=p>,</span> <span class=n>BIO_NOCLOSE</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>b64text</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span><span class=o>*</span><span class=p>)</span><span class=n>malloc</span><span class=p>((</span><span class=n>bufferPtr</span><span class=o>-&gt;</span><span class=n>length</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>char</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>memcpy</span><span class=p>(</span><span class=o>*</span><span class=n>b64text</span><span class=p>,</span> <span class=n>bufferPtr</span><span class=o>-&gt;</span><span class=n>data</span><span class=p>,</span> <span class=n>bufferPtr</span><span class=o>-&gt;</span><span class=n>length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=o>*</span><span class=n>b64text</span><span class=p>)[</span><span class=n>bufferPtr</span><span class=o>-&gt;</span><span class=n>length</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>BIO_free_all</span><span class=p>(</span><span class=n>bio</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><h3 id=最后通过main函数读入字符串并将三个过程连起来><a href=#最后通过main函数读入字符串并将三个过程连起来 class="header-mark headerLink">最后通过main函数读入字符串并将三个过程连起来</a></h3><div class=highlight><div class=chroma><div class=table-wrapper><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span><span class=o>*</span> <span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>argc</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>printf</span><span class=p>(</span><span class=s>&#34;usage: work.exe </span><span class=se>\&#34;</span><span class=s>string to hash and sign</span><span class=se>\&#34;</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span><span class=o>*</span> <span class=n>str</span> <span class=o>=</span> <span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;your str: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>str</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// first md5(str)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>md</span><span class=p>[</span><span class=n>MD5_DIGEST_LENGTH</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>md5_hash</span><span class=p>(</span><span class=n>str</span><span class=p>,</span> <span class=n>md</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// then gen rsa pkey and sign the md
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>RSA</span><span class=o>*</span> <span class=n>rsa</span> <span class=o>=</span> <span class=n>gen_rsa</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>char</span><span class=o>*</span> <span class=n>sig</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>unsigned</span> <span class=kt>char</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>siglen</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>RSA_sign</span><span class=p>(</span><span class=n>NID_sha1</span><span class=p>,</span> <span class=n>md</span><span class=p>,</span> <span class=n>MD5_DIGEST_LENGTH</span><span class=p>,</span> <span class=n>sig</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>siglen</span><span class=p>,</span> <span class=n>rsa</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// final Base64(sig)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>char</span><span class=o>*</span> <span class=n>b64text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Base64_encode</span><span class=p>(</span><span class=n>sig</span><span class=p>,</span> <span class=p>(</span><span class=n>size_t</span><span class=p>)</span><span class=n>siglen</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>b64text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>b64text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><blockquote><p>因为是课程作业，就没有对出现的错误情况进行处理，实际使用时需要考虑到</p></blockquote><h2 id=运行><a href=#运行 class="header-mark headerLink">运行</a></h2><h3 id=运行截图><a href=#运行截图 class="header-mark headerLink">运行截图</a></h3><p><img src=../../../posts/coding/openssl-first-try-rsa-md5-base64/run1_hu1ebefd56625b0904e9af14ded86be8e5_16611_1110x118_resize_q75_h2_box_3.webp alt=/posts/coding/openssl-first-try-rsa-md5-base64/run1_hu1ebefd56625b0904e9af14ded86be8e5_16611_1110x118_resize_q75_h2_box_3.webp title=运行截图 height=118 width=1110 loading=lazy></p><h3 id=生成的私钥文件><a href=#生成的私钥文件 class="header-mark headerLink">生成的私钥文件</a></h3><p><img src=../../../posts/coding/openssl-first-try-rsa-md5-base64/key1_hufd17b09baea8e971a6b50544cb114dcc_29346_620x273_resize_q75_h2_box_3.webp alt=/posts/coding/openssl-first-try-rsa-md5-base64/key1_hufd17b09baea8e971a6b50544cb114dcc_29346_620x273_resize_q75_h2_box_3.webp title=私钥 height=273 width=620 loading=lazy></p><h3 id=生成的公钥文件><a href=#生成的公钥文件 class="header-mark headerLink">生成的公钥文件</a></h3><p><img src=../../../posts/coding/openssl-first-try-rsa-md5-base64/key2_hu77fcc465899aaf9c3e0be57f84e56c55_11897_643x163_resize_q75_h2_box_3.webp alt=/posts/coding/openssl-first-try-rsa-md5-base64/key2_hu77fcc465899aaf9c3e0be57f84e56c55_11897_643x163_resize_q75_h2_box_3.webp title=公钥 height=163 width=643 loading=lazy></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023-10-10&nbsp;<a class=git-hash href=https://github.com/zu1k/blog/commit/74f0dc166006b304e3984f193b1d4ce1283d1e26 target=_blank title="commit by zu1k(i@zu1k.com) 74f0dc166006b304e3984f193b1d4ce1283d1e26: tags">
<i class=icon-hashtag></i>74f0dc1</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=../../../posts/coding/openssl-first-try-rsa-md5-base64/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a title="分享到 Twitter" data-sharer=twitter data-url=https://zu1k.com/posts/coding/openssl-first-try-rsa-md5-base64/ data-title=静态链接OpenSSL进行RSA\MD5\Base64 data-via=zu1k_ data-hashtags=OpenSSL,coding><i class=icon-twitter></i>
</a><a title="分享到 Tumblr" data-sharer=tumblr data-url=https://zu1k.com/posts/coding/openssl-first-try-rsa-md5-base64/ data-title=静态链接OpenSSL进行RSA\MD5\Base64 data-tags=OpenSSL,coding><i class=icon-tumblr></i>
</a><a title="分享到 Evernote" data-sharer=evernote data-url=https://zu1k.com/posts/coding/openssl-first-try-rsa-md5-base64/ data-title=静态链接OpenSSL进行RSA\MD5\Base64><i class=icon-evernote></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class=icon-tags></i>&nbsp;<a href=../../../tags/openssl/>OpenSSL</a>,&nbsp;<a href=../../../tags/coding/>编程</a></section><section><span><a onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=../../../>主页</a></span></section></div><div class=post-nav><a href=../../../posts/coding/speedup-docker-pull/ class=prev rel=prev title="加速docker pull"><i class=icon-angle-left></i>加速docker pull</a>
<a href=../../../posts/linux/ubuntu-iptables-nat/ class=next rel=next title=使用iptables将ubuntu配置为路由器>使用iptables将ubuntu配置为路由器<i class=icon-angle-right></i></a></div></div><div id=comments><div class=giscus id=giscus></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/zh-CN>Giscus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class=icon-copyright></i><span itemprop=copyrightYear>2017 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://zu1k.com target=_blank>zu1k</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class=icon-up></i>
</a><a id=view-comments class=fixed-button title=查看评论><i class=icon-comment></i></a></div><link rel=stylesheet href=../../../lib/lightgallery/lightgallery.min.css><script type=text/javascript src=../../../lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=../../../lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=../../../lib/fuse/fuse.min.js></script><script type=text/javascript src=../../../lib/instant-page/5.1.0.min.js></script><script type=text/javascript src=../../../lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=../../../lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=../../../lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=../../../lib/clipboard/clipboard.min.js></script><script type=text/javascript src=../../../lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:100},comment:{giscus:{category:"Comments",categoryid:"DIC_kwDOEfJ9084CA02V",enable:!0,mapping:"og:title",repo:"zu1k/blog",repoid:"MDEwOlJlcG9zaXRvcnkzMDExMDQ1OTU="}},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!0,isCaseSensitive:!1,location:null,maxResultLength:10,minMatchCharLength:1,noResultsFound:"没有找到结果",snippetLength:50,threshold:.6,type:"fuse",useExtendedSearch:!0}}</script><script type=text/javascript src=../../../js/theme.min.js></script></body></html>